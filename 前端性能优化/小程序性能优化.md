## 微信小程序性能优化

**一切性能优化都是为了体验优化**

优化的方向

#### 启动加载性能优化

##### 1、首次加载

在小程序启动时，微信会在背后完成以下工作：

- 下载小程序代码包（下载到的不是源码，而是比那一、压缩、打包之后的代码包）
- 加载小程序代码包
- 初始化小程序首页

##### 2、控制包大小

提升体验最直接的方法就是控制小程序包的大小

- 上传代码时，压缩代码
- 及时清理无用代码和资源文件（包括无用的日志代码等）
- 减少资源包中的图片等资源的数量和大小

##### 3、采用分包加载机制

根据业务场景，讲用户访问率高的页面放在主包里，将访问率第的页面放入子包，按需加载的

##### 4、采用分包预加载技术

在上一步的基础上，当用户点击子包的目录时才下载代码包，这时会明显感觉到卡顿，所有我们可以采用包预加载技术，并不需要等用户点击到子包页面时才下载，可根据后期数据做子包预加载，对于配置子包的预加载可以很灵活，是根据网络类型来判断的，当用户处于网络条件好的时候才预加载

##### 5、提前请求

异步请求可以在页面onLoad就加载，不需要等页面ready后再异步请求数据；当然，如果能在前置页面点击跳转时预请求当前页的核心异步请求，效果会更好；

##### 6、利用缓存

利用storage API变动频率较低的异步数据进行存储，二次启动时，先利用缓存数据进行初始化渲染，然后再异步数据更新

##### 7、避免白屏

利用骨架屏占位，用户体验好

##### 8、及时反馈

及时对需要用户等待的交互操作进行反馈，避免用户以为小程序卡死，无响应

#### 渲染性能优化

##### 1、小程序渲染原理

双线程下的界面渲染，小程序的逻辑层和渲染层是分开的两个线程。在渲染层，宿主环境会把WXML转换成JS对象，在逻辑层发生数据变更的时候，我们通过宿主环境提供的setData方法把数据从逻辑层传递到渲染层。把差异应用到原来的DOM树上，渲染出正确的UI界面

分析这个流程得出：页面初始化的时间大致由**页面初始数据通信时间**和**初始渲染时间**两部分构成。数据通信时间指数据从逻辑层开始组织到视图层完全接收完毕的时间。因而减少数据传输量是降低数据传输时间的有效方式

##### 2、避免使用不当setData

- 不要频繁的使用setData，应考虑将多次setData合并成一次setData调用；
  - 每次setData的调用都是一次进程通信过程
  - setData是小程序开发中使用最繁琐，也是最容易引发性能问题的

##### 3、与界面渲染无关的数据最好不要放在data中









































