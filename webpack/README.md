## webpack

#### 什么是webpack

Webpack可以看作是模块打包机，它做到事情就是分析你的项目结构，找到JavaScript模块以及其他浏览器不能直接运行的扩展语言(scss,ts)等，并将其打包为合适的格式以供浏览器使用



#### 为什么要使用webpack

当今的一些网页其实可以看做功能丰富的应用，为了提高开发效率，前端社区涌现出很多好的解决方案，如

a.类似于TypeScript这种在javascript基础上扩展的开发语言，使我们能够实现目前版本的javascript不能直接使用的特性，并且还能转换为JavaScript文件使浏览器可以识别

b:scss、less等CSS预处理器

......

这些改进确实大大的提高了我们的开发效率，但是利用他们处理的文件往往需要进行额外的处理才能让浏览器识别，并且有一大堆的依赖包，如果这些包之前还有严格的依赖关系的话，手动处理的话就会非常繁琐，这就为Webpack这类工具的出现提供了需求。

 Webpack通过配置一个入口文件，将从这个文件开始找到你的项目的所有依赖文件，使用loaders处理它们，最后打包为一个浏览器可识别的JavaScript文件。 大大提高了开发效率和开发体验。

**优点：模块化**

在webpack看来一切都是模块，包括你的JavaScript代码，包括CSS和fonts以及图片等等，只有通过合适的loader，它们都可以被当作模块处理。



#### loader和plugin

- **loader**

  loader直译为“加载器”。webpack将一切文件视为模块，但是webpack原生只能解析js文件，如果想将其他文件也打包的话，就会用到loader。所以loader的作用是让webpack拥有加载和解析非js文件的能力。

  简单来说是实现对不同格式文件的处理，比如将scss转换为css，将typescript转换为js

  - **常用loader**
    1. css-loader:加载CSS，支持模块化、压缩、文件导入等特性
    2. style-loader：将css代码注入到javascript，通过DOM操作去加载css
    3. url-loader:y用户可以设置一个阈值，小于阈值时返回文件的base64形式编码编码
    4. babel-loader：将ES6转换为ES5
    5. imge-loader:加载并且压缩图片文件
    6. ts-loader
    7. vue-loader:加载vue.jss单文件组件

- **plugin**

  plugin直译为“插件”，plugin可以扩展webpack的功能

  - **常见plugin**
    1. `commons-chunk-plugin`：提取公共代码
    2.  `webpack-bundle-analyzer`: 可视化 Webpack 输出文件的体积 (业务组件、依赖第三方模块) 

- **loader与plugin区别**

  - loader在`module.rules`中配置，也就是说它作为模板的解析规则而存在。类型为数组，每一项都是一个object，里面描述了对于什么类型文件（test）,使用什么加载（loader）
  - plugin在plugins中单独配置。类型为数组，每一项是一个plugin的实例。



#### webpack构建流程

webpack的运行流程是一个串行的过程，从启动到结束会依次执行以下流程：

1. **初始化参数**：从配置文件和shell语句中读取与合并参数，得到最终参数
2. **开始编译**：用上一步得到的参数初始化Compiler对象，加载所有配置的插件，执行对象的run方法开始执行编译
3. **确定入口**：根据配置中的entry找到所有的入口文件
4. **编译模块**：从入口文件出发，调用所有配置的loader对模块进行翻译，再找出该模块依赖的模块，再递归本步骤知道所有入口依赖的文件都经过了本步骤的处理
5. **完成模块编译**：再经历第四步使用Loader翻译完所有模块后，得到了每个模块被翻译后的最终内容以及它们之间的依赖关系   
6. **输出资源**：根据入口和模块之间的依赖关系，组装成一个个包含多模块的chunk,再把每个chunck转换成一个单独的文件加入到输出列表，这是修改输出内容的最好机会
7. **输出完成**：在确定好输出内容后，根据配置确定输出的路径和文件名，把文件内容写入到文件系统中 。



#### webpack热更新原理

热更新：可以做到不用刷新浏览器而将新更新的模块替换掉旧的模块

热更新的核心就是客户端从服务端拉取更新后的文件，实际上与浏览器之间维护了一个websocket，当本地资源发生变化时，服务器会向浏览器推送更新



