## HTTP

#### 请求报文

请求报文是由请求方法、请求URL、协议版本、可选的请求首部字段和内容实体构成的

`` GET /index.htm HTTP/1.1``

#### 响应报文

响应报文由协议版本、状态码、用以解释转台吗原因短语、可选的响应首部字段以及实体主体构成。

``HTTP/1.1 200 OK``

#### HTTP方法

- GET：获取资源
- POST：传输实体主体
- PUT：传输文件
- HEAD：获得报文首部。不返回报文主体，用于确认URI的有效性及资源更新的日期时间等
- DELETE：删除文件
- OPTIONS：询问支持的方法。针对请求URL资源查询支持的方法。

#### 持久连接——HTTP/1.1

持久连接的好处在于减少TCP连接的重复建立和断开所造成额外开销

#### 管线化

从前发送请求后需要等待并收到响应，才能发送下一个请求。管线化技术出现后，不用等待响应亦可直接发送下一个请求，这样就能够做到同时并发多个请求，而不需要一个接一个地等待响应

#### 无状态——使用cookie的状态管理

无状态的优点：由于不需要保存状态，自然可减少服务器CPU以及内存的消耗。

解决无状态的方法：`Cookie`

- `Cookie`会根据从服务端发送的响应报文内的一个叫做`set-cookie`的首部字段信息
- 通知客户端保存`Cookie`
- 当下次客户端再往该服务器发送请求时，客户端会自动再请求报文中加入`Cookie`后发送出去
- 服务器端发现客户端发送过来的`Cookie`后，会检查究竟从哪一个客户端发来的连接请求，然后对比服务器上记录，最后得到之前的状态信息

----

## HTTP首部

#### 通用首部字段

- `Cache-Control`
  - 缓存相关
- `Connection`
  - 管理持久连接

#### 请求首部字段

- `Accept`
  - 可通知服务器，用户代理能够处理的媒体类型及媒体类型的相对优先级
  - 文本文件`text/html,text/plain,text/css,application/xml`
  - 图片文件`image/jpeg,image/png`
  - 视频文件`video/mpeg`
  - 二进制文件`application/octet-stream`
- `Accept-Encoding:gzip`
  - 用来告知服务器用户代理支持的内容编码及内容编码的优先级顺序
- `Range:bytes=5001-10000`
  - 对于只需获取部分资源资源的范围请求，包含首部字段Range即可告诉服务器资源的指定范围。上面的实例表示请求获取从第5001字节至第10000字节的资源
- `Referer`
  - 告知服务器请求的原始资源的URI
- `user-agent`
  - 会将创建请求的浏览器和用户代理名称等信息传达给服务器

#### 响应首部字段

- `ETag`
  - 将资源以字符串形式做唯一性标识
- `Location`
  - 用于重定向，将响应接收方引导至某个与请求URI位置不同的资源
- `Server:Apache/2.2.6 PHP/5.2.5`
  - 告知客户端当前服务器上安装HTTP服务器应用程序的信息

#### 实体首部字段

实体首部字段是包含在请求报文和响应报文中的实体部分所使用的首部，用户补充实体相关信息

- `Allow:GET,HEAD`
  - 用于通知客户端能够支持指定资源的所有HTTP方法，**当服务器收到不支持的HTTP方法时，会以状态码405 Method Not Allowed作为响应返回**
- `Content-Type:text/html;`
  - 说明实体主体内对象的媒体类型

#### `Set-Cookie`

- `HttpOnly`属性
  - 它使Javascript脚本无法获得Cookie，其主要目的是为了防止跨脚本攻击（XSS）对Cookie的信息窃取

---

## HTTPS

HTTP+加密+认证+完整性保护=HTTPS

- 对称加密：加密解密都用同一各密钥，一旦黑客截取到密钥，相当于没有加密
- 非对称加密：公钥可以给任何一个人，私钥由自己保存，不能泄漏，但是使用非对称加密，s——>c不安全
- 对称加密+非对称加密：使用非对称加密协商出来一个对称加密的密钥，之后用对称加密传输数据，但是无法证实公开密钥就是货真公钥，一旦中间人从第一步就介入，则中间人可能截取真正公钥，而发送客户端自己的公钥
- 数字证书：找一个权威的第三方来颁发公开密钥证书，以保证客户端得到的公钥是可信赖的公钥

**HTTPS的通信步骤**

![](..\img\https.png)

1. 客户端发送`Client Hello`报文开始SSL通信。报文中包含客户端支持的SSL的指定版本、加密组件列表
2. 服务器可进行SSL通信时，会以`Server Hello`报文作为应答。和客户端一样，在报文中包含SSL版本以及加密组件。服务端的加密组件内容是从接收的客户端加密组件内筛选出来的
3. 之后服务器发送`Certificate`报文。报文中包含公开密钥证书
4. 最后服务端发送`Server Hello Done`报文通知客户端，最初的SSL握手协商部分结束
5. SSL第一次握手结束之后，客户端以`Client Key Exchange`报文作为回应。报文中包含通信加密中使用的一种被称为`pre-master secret`的随机密码串。该报文已用步骤3中的公开密钥进行加密
6. 接着客户端继续发送`Change cipher spec`报文。该报文会提示服务器，在此报文之后的通信采用`pre-master secret`密钥加密
7. 客户端发送`Finished`报文。高保温包含至今全部报文的整体校验值。这次握手协议是否能够成功，要以服务器是否能够正确解密高报文作为判定标准
8. 服务器同样发送`Change cipher spec`报文
9. 服务器同样发送`Finished`报文
10. 服务器和客户端的finished报文交换完毕之后，SSL连接就算建立完成。从此处开始进行HTTP请求